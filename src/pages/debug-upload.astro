---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Upload Progress Debugger">
    <div class="min-h-screen flex items-center justify-center p-6 bg-slate-950">
        <div class="max-w-xl w-full bg-slate-900 border border-white/10 p-10 rounded-[3rem] shadow-2xl relative overflow-hidden">
            <div class="absolute -right-20 -top-20 w-64 h-64 bg-cyan-500/10 rounded-full blur-[100px]"></div>
            
            <div class="relative z-10">
                <h1 class="text-3xl font-black text-white mb-2 uppercase tracking-tighter">Progress Bar Debugger</h1>
                <p class="text-slate-500 mb-8 italic">Simulasi upload untuk mengetes visual progress bar.</p>

                <div class="space-y-8">
                    <!-- Control Unit -->
                    <div class="p-6 bg-slate-950/50 rounded-2xl border border-white/5 space-y-4">
                        <label class="block text-[10px] font-black uppercase tracking-widest text-slate-400">Kecepatan Simulasi</label>
                        <input type="range" id="speed-range" min="10" max="500" value="100" class="w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500">
                        <div class="flex justify-between text-[9px] font-bold text-slate-600 uppercase">
                            <span>Cepat</span>
                            <span>Lambat</span>
                        </div>
                    </div>

                    <!-- The Progress Bar Component (Copy of Manage Resources) -->
                    <div id="test-container" class="space-y-4 p-8 bg-slate-950 rounded-[2rem] border border-cyan-500/20 shadow-2xl shadow-cyan-500/5">
                        <div class="flex justify-between items-center text-[10px] font-black uppercase tracking-widest">
                            <span id="test-status" class="text-cyan-400">Standby...</span>
                            <span id="test-percent" class="text-white text-xs font-black">0%</span>
                        </div>
                        
                        <!-- THE ACTUAL BAR BEING TESTED -->
                        <div class="w-full h-4 bg-slate-900 rounded-full overflow-hidden border border-white/10 relative shadow-inner">
                            <div id="test-bar" class="absolute left-0 top-0 h-full bg-cyan-500" style="width: 0%;"></div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button id="start-btn" class="flex-1 py-4 bg-cyan-600 hover:bg-cyan-500 text-white rounded-2xl font-black uppercase tracking-widest text-xs shadow-xl shadow-cyan-600/20 transition-all active:scale-95">
                            Mulai Simulasi
                        </button>
                        <button id="reset-btn" class="px-8 py-4 bg-white/5 hover:bg-white/10 text-white rounded-2xl font-black uppercase tracking-widest text-xs border border-white/10 transition-all">
                            Reset
                        </button>
                    </div>

                    <div class="p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl text-[10px] text-amber-200/70 leading-relaxed italic">
                        *Jika bar di halaman ini jalan tapi di halaman Admin tidak, berarti masalahnya ada di event listener Supabase Storage atau koneksi internetmu.
                    </div>
                </div>
            </div>
        </div>
    </div>
</Layout>

<script>
    const bar = document.getElementById('test-bar');
    const percentText = document.getElementById('test-percent');
    const statusText = document.getElementById('test-status');
    const startBtn = document.getElementById('start-btn') as HTMLButtonElement;
    const resetBtn = document.getElementById('reset-btn');
    const speedRange = document.getElementById('speed-range') as HTMLInputElement;

    let progress = 0;
    let interval: any = null;

    function startSimulation() {
        if (interval) return;
        
        startBtn.disabled = true;
        startBtn.innerText = 'SIMULATING...';
        statusText!.innerText = 'Uploading Data Packets...';
        statusText!.classList.add('animate-pulse');

        const speed = parseInt(speedRange.value);

        interval = setInterval(() => {
            progress += 1;
            
            // UPDATE VISUALS (Same logic as admin page)
            if (bar) bar.style.width = progress + '%';
            if (percentText) percentText.innerText = progress + '%';

            if (progress >= 100) {
                clearInterval(interval);
                interval = null;
                statusText!.innerText = 'Upload Complete!';
                statusText!.classList.remove('animate-pulse');
                statusText!.classList.replace('text-cyan-400', 'text-emerald-400');
                startBtn.classList.replace('bg-cyan-600', 'bg-emerald-600');
                startBtn.innerText = 'SUCCESS';
            }
        }, speed);
    }

    function reset() {
        clearInterval(interval);
        interval = null;
        progress = 0;
        if (bar) bar.style.width = '0%';
        if (percentText) percentText.innerText = '0%';
        statusText!.innerText = 'Standby...';
        statusText!.className = 'text-cyan-400';
        startBtn.disabled = false;
        startBtn.innerText = 'Mulai Simulasi';
        startBtn.className = 'flex-1 py-4 bg-cyan-600 hover:bg-cyan-500 text-white rounded-2xl font-black uppercase tracking-widest text-xs shadow-xl shadow-cyan-600/20 transition-all active:scale-95';
    }

    startBtn.addEventListener('click', startSimulation);
    resetBtn?.addEventListener('click', reset);
</script>
