---
import Layout from '../layouts/Layout.astro';
import { supabase } from '../lib/supabase';

export const prerender = false;

// Fetch data from the leaderboard view
const { data: rankings } = await supabase
    .from('leaderboard')
    .select('*')
    .limit(10);

const topThree = rankings?.slice(0, 3) || [];
const rest = rankings?.slice(3) || [];
---

<Layout title="Hall of Fame - Kelas TKJ">
    <div class="max-w-7xl mx-auto px-6 py-12">
        <header class="text-center mb-20 relative">
            <div class="absolute inset-0 -z-10 bg-gradient-to-b from-yellow-500/10 via-transparent to-transparent blur-[120px]"></div>
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-yellow-500/10 border border-yellow-500/20 text-yellow-500 text-[10px] font-black uppercase tracking-[0.4em] mb-6">
                Elite Rankings
            </div>
            <h1 class="text-7xl font-black text-white tracking-tighter mb-6 bg-clip-text text-transparent bg-gradient-to-b from-white to-slate-500">Hall of Fame</h1>
            <p class="text-lg text-slate-400 max-w-2xl mx-auto">Penghargaan untuk para jawara TKJ yang paling aktif berkontribusi dan rajin belajar di platform.</p>
        </header>

        <!-- Top 3 Podium -->
        <div class="flex flex-col md:flex-row justify-center items-end gap-6 mb-20">
            {/* Rank 2 */}
            {topThree[1] && (
                <div class="order-2 md:order-1 flex-1 max-w-sm">
                    <div class="bg-slate-900/50 border border-white/5 p-8 rounded-[3rem] text-center relative group hover:border-slate-400/30 transition-all duration-500">
                        <div class="absolute -top-12 left-1/2 -translate-x-1/2">
                            <div class="w-24 h-24 rounded-[2rem] bg-slate-800 border-4 border-slate-400/50 overflow-hidden group-hover:scale-110 transition-transform shadow-2xl">
                                <img src={topThree[1].avatar_url || `https://ui-avatars.com/api/?name=${topThree[1].full_name}&background=64748b&color=fff`} class="w-full h-full object-cover" />
                            </div>
                            <div class="absolute -bottom-2 -right-2 w-10 h-10 rounded-full bg-slate-400 flex items-center justify-center font-black text-slate-900 text-sm shadow-xl">2</div>
                        </div>
                        <h3 class="text-2xl font-black text-white mt-12 mb-2 uppercase truncate">{topThree[1].full_name}</h3>
                        <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-6">Master Technician</div>
                        <div class="text-4xl font-black text-slate-300 mb-2">{topThree[1].total_points}</div>
                        <div class="text-[8px] font-black text-slate-600 uppercase tracking-widest">Points Secured</div>
                    </div>
                </div>
            )}

            {/* Rank 1 */}
            {topThree[0] && (
                <div class="order-1 md:order-2 flex-1 max-w-md">
                    <div class="bg-gradient-to-b from-yellow-500/10 to-transparent border-2 border-yellow-500/20 p-10 rounded-[4rem] text-center relative group hover:border-yellow-500/50 transition-all duration-500 shadow-2xl shadow-yellow-500/5">
                        <div class="absolute -top-16 left-1/2 -translate-x-1/2">
                             <div class="absolute -inset-4 bg-yellow-500/20 blur-xl rounded-full animate-pulse"></div>
                             <div class="relative w-32 h-32 rounded-[2.5rem] bg-yellow-600 border-4 border-yellow-500 overflow-hidden group-hover:scale-110 transition-transform shadow-2xl">
                                <img src={topThree[0].avatar_url || `https://ui-avatars.com/api/?name=${topThree[0].full_name}&background=eab308&color=000`} class="w-full h-full object-cover" />
                            </div>
                            <div class="absolute -bottom-2 -right-2 w-12 h-12 rounded-full bg-yellow-500 flex items-center justify-center font-black text-black text-lg shadow-xl ring-4 ring-slate-950">1</div>
                        </div>
                        <div class="mt-16 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="mx-auto text-yellow-500 mb-4 animate-bounce"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                        </div>
                        <h3 class="text-3xl font-black text-white mb-2 uppercase tracking-tight">{topThree[0].full_name}</h3>
                        <div class="text-[10px] font-black text-yellow-500 uppercase tracking-[0.3em] mb-8">Legendary Specialist</div>
                        <div class="text-6xl font-black text-white mb-4 tracking-tighter drop-shadow-2xl">{topThree[0].total_points}</div>
                        <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Ultimate Power Score</div>
                    </div>
                </div>
            )}

            {/* Rank 3 */}
            {topThree[2] && (
                <div class="order-3 md:order-3 flex-1 max-w-sm">
                   <div class="bg-slate-900/50 border border-white/5 p-8 rounded-[3rem] text-center relative group hover:border-orange-500/30 transition-all duration-500">
                        <div class="absolute -top-12 left-1/2 -translate-x-1/2">
                            <div class="w-24 h-24 rounded-[2rem] bg-slate-800 border-4 border-orange-500/50 overflow-hidden group-hover:scale-110 transition-transform shadow-2xl">
                                <img src={topThree[2].avatar_url || `https://ui-avatars.com/api/?name=${topThree[2].full_name}&background=f97316&color=fff`} class="w-full h-full object-cover" />
                            </div>
                            <div class="absolute -bottom-2 -right-2 w-10 h-10 rounded-full bg-orange-500 flex items-center justify-center font-black text-white text-sm shadow-xl">3</div>
                        </div>
                        <h3 class="text-2xl font-black text-white mt-12 mb-2 uppercase truncate">{topThree[2].full_name}</h3>
                        <div class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-6">Expert Operator</div>
                        <div class="text-4xl font-black text-orange-400 mb-2">{topThree[2].total_points}</div>
                        <div class="text-[8px] font-black text-slate-600 uppercase tracking-widest">Points Secured</div>
                    </div>
                </div>
            )}
        </div>

        {/* The List of Others */}
        <div class="max-w-4xl mx-auto space-y-4">
            {rest.map((player, idx) => (
                <div class="flex items-center gap-6 p-6 bg-slate-900/30 border border-white/5 rounded-3xl group hover:border-white/10 transition-all">
                    <div class="text-xl font-black text-slate-600 w-8">{idx + 4}</div>
                    <div class="w-12 h-12 rounded-2xl bg-slate-800 overflow-hidden">
                        <img src={player.avatar_url || `https://ui-avatars.com/api/?name=${player.full_name}`} class="w-full h-full object-cover" />
                    </div>
                    <div class="flex-1">
                        <h4 class="font-black text-white uppercase tracking-tight">{player.full_name}</h4>
                        <div class="flex gap-4 mt-1">
                            <span class="text-[9px] font-bold text-slate-500 uppercase">{player.total_posts} Articles</span>
                            <span class="text-[9px] font-bold text-slate-500 uppercase">{player.attendance_count} Attendances</span>
                        </div>
                    </div>
                    <div class="text-xl font-black text-white">{player.total_points}</div>
                </div>
            ))}
        </div>
    </div>
</Layout>
